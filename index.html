<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Muro de Comentarios - Unidad 3</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Vue 3 CDN (opcional) -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="bg-primary text-white py-3 mb-4">
    <div class="container">
      <h1 class="h3">Muro de Comentarios — Unidad 3 (Programación del lado del cliente)</h1>
      <p id="urgentCounter" class="mb-0">Comentarios urgentes: <span id="urgentCount">0</span></p>
    </div>
  </header>

  <main class="container" id="app">
    <section class="row mb-4">
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Escribe un comentario</h5>
            <form @submit.prevent="handleSubmit">
              <div class="mb-2">
                <label class="form-label">Nombre</label>
                <input v-model="form.nombre" class="form-control" type="text" />
                <div v-if="errors.nombre" class="form-text text-danger">{{ errors.nombre }}</div>
              </div>
              <div class="mb-2">
                <label class="form-label">Email</label>
                <input v-model="form.email" class="form-control" type="email" />
                <div v-if="errors.email" class="form-text text-danger">{{ errors.email }}</div>
              </div>
              <div class="mb-2">
                <label class="form-label">Prioridad</label>
                <select v-model="form.prioridad" class="form-select">
                  <option value="baja">Baja</option>
                  <option value="normal">Normal</option>
                  <option value="alta">Alta</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="form-label">Mensaje</label>
                <textarea v-model="form.mensaje" rows="4" class="form-control"></textarea>
                <div v-if="errors.mensaje" class="form-text text-danger">{{ errors.mensaje }}</div>
              </div>
              <button class="btn btn-primary" type="submit">Enviar</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card shadow-sm mb-3">
          <div class="card-body">
            <h5 class="card-title">Buscar / Filtrar</h5>
            <div class="mb-2">
              <input v-model="search" placeholder="Buscar texto..." class="form-control" />
            </div>
            <div class="mb-2 d-flex gap-2">
              <button class="btn btn-outline-secondary" @click="filter='todas'">Todas</button>
              <button class="btn btn-outline-secondary" @click="filter='alta'">Alta</button>
              <button class="btn btn-outline-secondary" @click="filter='normal'">Normal</button>
              <button class="btn btn-outline-secondary" @click="filter='baja'">Baja</button>
            </div>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Estadísticas</h5>
            <p>Total de comentarios: <strong>{{ messages.length }}</strong></p>
            <p>Urgentes: <strong>{{ urgentCount }}</strong></p>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2 class="h5 mb-3">Lista de comentarios</h2>
      <div v-if="filteredMessages.length === 0" class="text-muted">No hay comentarios.</div>

      <div class="list-group">
        <div v-for="(m, idx) in filteredMessages" :key="m.id"
             :class="['list-group-item', 'mb-2', m.prioridad === 'alta' ? 'border-danger' : '', m.leido ? '' : 'bg-light']">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ m.nombre }} <small class="text-muted">({{ m.email }})</small></h5>
            <small>{{ formatDate(m.fecha) }}</small>
          </div>
          <p class="mb-1">{{ m.mensaje }}</p>
          <small>Prioridad: <strong>{{ m.prioridad }}</strong></small>
          <div class="mt-2">
            <button class="btn btn-sm btn-outline-success me-2" @click="toggleRead(idx)">
              {{ m.leido ? 'Marcar no leído' : 'Marcar leído' }}
            </button>
            <button class="btn btn-sm btn-outline-danger" @click="remove(idx)">Eliminar</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="text-muted py-4 mt-4">
    <div class="container">
      <small>Hecho como práctica — Unidad 3. Programación del lado del cliente.</small>
    </div>
  </footer>

  <script src="js/app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
